<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        <link href="./assets/4b76110e/css/bootstrap.css" rel="stylesheet">
<link href="./assets/710de68d/style.css" rel="stylesheet">
<script src="./assets/75e46bf0/jquery.js"></script>
<script src="./assets/4b76110e/js/bootstrap.js"></script>
<script src="./assets/a44c75fa/jssearch.js"></script>    <title>Yii Framework 2.0 API Documentation</title>
</head>
<body>

<div class="wrap">
    <nav id="w78" class="navbar-inverse navbar-fixed-top navbar" role="navigation"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w78-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./index.html">Yii Framework 2.0 API Documentation</a></div><div id="w78-collapse" class="collapse navbar-collapse"><ul id="w79" class="navbar-nav nav"><li><a href="./index.html">Class reference</a></li>
<li><a href="./guide-en-README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>Implementing RESTful Web Service APIs <a href="#implementing-restful-web-service-apis" name="implementing-restful-web-service-apis" class="hashlink">&para;</a></h1><p>Yii provides a whole set of tools to greatly simplify the task of implementing RESTful Web Service APIs.
In particular, Yii provides support for the following aspects regarding RESTful APIs:</p>
<ul>
<li>Quick prototyping with support for common APIs for ActiveRecord;</li>
<li>Response format (supporting JSON and XML by default) negotiation;</li>
<li>Customizable object serialization with support for selectable output fields;</li>
<li>Proper formatting of collection data and validation errors;</li>
<li>Efficient routing with proper HTTP verb check;</li>
<li>Support <code>OPTIONS</code> and <code>HEAD</code> verbs;</li>
<li>Authentication;</li>
<li>Authorization;</li>
<li>Support for HATEOAS;</li>
<li>Caching via <code>yii\filters\HttpCache</code>;</li>
<li>Rate limiting;</li>
<li>Searching and filtering: TBD</li>
<li>Testing: TBD</li>
<li>Automatic generation of API documentation: TBD</li>
</ul>
<h2>A Quick Example <a href="#a-quick-example" name="a-quick-example" class="hashlink">&para;</a></h2><p>Let's use a quick example to show how to build a set of RESTful APIs using Yii.
Assume you want to expose the user data via RESTful APIs. The user data are stored in the user DB table,
and you have already created the ActiveRecord class <code>app\models\User</code> to access the user data.</p>
<p>First, create a controller class <code>app\controllers\UserController</code> as follows,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">namespace&nbsp;</span><span style="color: #0000BB">app</span><span style="color: #007700">\</span><span style="color: #0000BB">controllers</span><span style="color: #007700">;<br /><br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">rest</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveController</span><span style="color: #007700">;<br /><br />class&nbsp;</span><span style="color: #0000BB">UserController&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveController<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$modelClass&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'app\models\User'</span><span style="color: #007700">;<br />}</span></code></pre>
<p>Then, modify the configuration about the <code>urlManager</code> component in your application configuration:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #DD0000">'urlManager'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'enablePrettyUrl'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'enableStrictParsing'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'showScriptName'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'rules'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'yii\rest\UrlRule'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'controller'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'user'</span><span style="color: #007700">],<br />&nbsp;&nbsp;&nbsp;&nbsp;],<br />]</span></code></pre>
<p>With the above minimal amount of effort, you have already finished your task of creating the RESTful APIs
for accessing the user data. The APIs you have created include:</p>
<ul>
<li><code>GET /users</code>: list all users page by page;</li>
<li><code>HEAD /users</code>: show the overview information of user listing;</li>
<li><code>POST /users</code>: create a new user;</li>
<li><code>GET /users/123</code>: return the details of the user 123;</li>
<li><code>HEAD /users/123</code>: show the overview information of user 123;</li>
<li><code>PATCH /users/123</code> and <code>PUT /users/123</code>: update the user 123;</li>
<li><code>DELETE /users/123</code>: delete the user 123;</li>
<li><code>OPTIONS /users</code>: show the supported verbs regarding endpoint <code>/users</code>;</li>
<li><code>OPTIONS /users/123</code>: show the supported verbs regarding endpoint <code>/users/123</code>.</li>
</ul>
<p>You may access your APIs with the <code>curl</code> command like the following,</p>
<pre><code>curl -i -H "Accept:application/json" "http://localhost/users"
</code></pre>
<p>which may give the following output:</p>
<pre><code>HTTP/1.1 200 OK
Date: Sun, 02 Mar 2014 05:31:43 GMT
Server: Apache/2.2.26 (Unix) DAV/2 PHP/5.4.20 mod_ssl/2.2.26 OpenSSL/0.9.8y
X-Powered-By: PHP/5.4.20
X-Pagination-Total-Count: 1000
X-Pagination-Page-Count: 50
X-Pagination-Current-Page: 1
X-Pagination-Per-Page: 20
Link: &lt;http://localhost/users?page=1&gt;; rel=self, 
      &lt;http://localhost/users?page=2&gt;; rel=next, 
      &lt;http://localhost/users?page=50&gt;; rel=last
Transfer-Encoding: chunked
Content-Type: application/json; charset=UTF-8

[
    {
        "id": 1,
        ...
    },
    {
        "id": 2,
        ...
    },
    ...
]
</code></pre>
<p>Try changing the acceptable content type to be <code>application/xml</code>, and you will see the result
is returned in XML format:</p>
<pre><code>curl -i -H "Accept:application/xml" "http://localhost/users"
</code></pre>
<pre><code>HTTP/1.1 200 OK
Date: Sun, 02 Mar 2014 05:31:43 GMT
Server: Apache/2.2.26 (Unix) DAV/2 PHP/5.4.20 mod_ssl/2.2.26 OpenSSL/0.9.8y
X-Powered-By: PHP/5.4.20
X-Pagination-Total-Count: 1000
X-Pagination-Page-Count: 50
X-Pagination-Current-Page: 1
X-Pagination-Per-Page: 20
Link: &lt;http://localhost/users?page=1&gt;; rel=self, 
      &lt;http://localhost/users?page=2&gt;; rel=next, 
      &lt;http://localhost/users?page=50&gt;; rel=last
Transfer-Encoding: chunked
Content-Type: application/xml

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;response&gt;
    &lt;item&gt;
        &lt;id&gt;1&lt;/id&gt;
        ...
    &lt;/item&gt;
    &lt;item&gt;
        &lt;id&gt;2&lt;/id&gt;
        ...
    &lt;/item&gt;
    ...
&lt;/response&gt;
</code></pre>
<blockquote><p>Tip: You may also access your APIs via Web browser by entering the URL <code>http://localhost/users</code>.</p>
</blockquote>
<p>As you can see, in the response headers, there are information about the total count, page count, etc.
There are also links that allow you to navigate to other pages of data. For example, <code>http://localhost/users?page=2</code>
would give you the next page of the user data.</p>
<p>Using the <code>fields</code> and <code>expand</code> parameters, you may also request to return a subset of the fields in the result.
For example, the URL <code>http://localhost/users?fields=id,email</code> will only return the <code>id</code> and <code>email</code> fields in the result:</p>
<blockquote><p>Info: You may have noticed that the result of <code>http://localhost/users</code> includes some sensitive fields,
such as <code>password_hash</code>, <code>auth_key</code>. You certainly do not want these to appear in your API result.
You can/should filter out these fields as described in the following sections.</p>
</blockquote>
<p>In the following sections, we will explain in more details about implementing RESTful APIs.</p>
<h2>General Architecture <a href="#general-architecture" name="general-architecture" class="hashlink">&para;</a></h2><p>Using the Yii RESTful API framework, you implement an API endpoint in terms of a controller action, and you use
a controller to organize the actions that implement the endpoints for a single type of resource.</p>
<p>Resources are represented as data models which extend from the <span class="broken-link">yii\base\Model</span> class.
If you are working with databases (relational or NoSQL), it is recommended you use ActiveRecord to represent resources.</p>
<p>You may use <span class="broken-link">yii\rest\UrlRule</span> to simplify the routing to your API endpoints.</p>
<p>While not required, it is recommended that you develop your RESTful APIs as an application, separated from
your Web front end and back end.</p>
<h2>Creating Resource Classes <a href="#creating-resource-classes" name="creating-resource-classes" class="hashlink">&para;</a></h2><p>RESTful APIs are all about accessing and manipulating resources. In Yii, a resource can be an object of any class.
However, if your resource classes extend from <span class="broken-link">yii\base\Model</span> or its child classes (e.g. <span class="broken-link">yii\db\ActiveRecord</span>),
you may enjoy the following benefits:</p>
<ul>
<li>Input data validation;</li>
<li>Query, create, update and delete data, if extending from <span class="broken-link">yii\db\ActiveRecord</span>;</li>
<li>Customizable data formatting (to be explained in the next section).</li>
</ul>
<h2>Formatting Response Data <a href="#formatting-response-data" name="formatting-response-data" class="hashlink">&para;</a></h2><p>By default, Yii supports two response formats for RESTful APIs: JSON and XML. If you want to support
other formats, you should configure the <code>contentNegotiator</code> behavior in your REST controller classes as follows,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">helpers</span><span style="color: #007700">\</span><span style="color: #0000BB">ArrayHelper</span><span style="color: #007700">;<br /><br />public&nbsp;function&nbsp;</span><span style="color: #0000BB">behaviors</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">ArrayHelper</span><span style="color: #007700">::</span><span style="color: #0000BB">merge</span><span style="color: #007700">(</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">behaviors</span><span style="color: #007700">(),&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'contentNegotiator'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'formats'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;...&nbsp;other&nbsp;supported&nbsp;formats&nbsp;...<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br />&nbsp;&nbsp;&nbsp;&nbsp;]);<br />}</span></code></pre>
<p>Formatting response data in general involves two steps:</p>
<ol>
<li>The objects (including embedded objects) in the response data are converted into arrays by <span class="broken-link">yii\rest\Serializer</span>;</li>
<li>The array data are converted into different formats (e.g. JSON, XML) by <span class="broken-link">yii\web\ResponseFormatterInterface</span>.</li>
</ol>
<p>Step 2 is usually a very mechanical data conversion process and can be well handled by the built-in response formatters.
Step 1 involves some major development effort as explained below.</p>
<p>When the <span class="broken-link">yii\rest\Serializer</span> converts an object into an array, it will call the <code>toArray()</code> method
of the object if it implements <span class="broken-link">yii\base\Arrayable</span>. If an object does not implement this interface,
its public properties will be returned instead.</p>
<p>For classes extending from <span class="broken-link">yii\base\Model</span> or <span class="broken-link">yii\db\ActiveRecord</span>, besides directly overriding <code>toArray()</code>,
you may also override the <code>fields()</code> method and/or the <code>extraFields()</code> method to customize the data being returned.</p>
<p>The method <span class="broken-link">yii\base\Model::fields()</span> declares a set of <em>fields</em> that should be included in the result.
A field is simply a named data item. In a result array, the array keys are the field names, and the array values
are the corresponding field values. The default implementation of <span class="broken-link">yii\base\Model::fields()</span> is to return
all attributes of a model as the output fields; for <span class="broken-link">yii\db\ActiveRecord::fields()</span>, by default it will return
the names of the attributes whose values have been populated into the object.</p>
<p>You can override the <code>fields()</code> method to add, remove, rename or redefine fields. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;explicitly&nbsp;list&nbsp;every&nbsp;field,&nbsp;best&nbsp;used&nbsp;when&nbsp;you&nbsp;want&nbsp;to&nbsp;make&nbsp;sure&nbsp;the&nbsp;changes<br />//&nbsp;in&nbsp;your&nbsp;DB&nbsp;table&nbsp;or&nbsp;model&nbsp;attributes&nbsp;do&nbsp;not&nbsp;cause&nbsp;your&nbsp;field&nbsp;changes&nbsp;(to&nbsp;keep&nbsp;API&nbsp;backward&nbsp;compatibility).<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">fields</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;field&nbsp;name&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;attribute&nbsp;name<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'id'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;field&nbsp;name&nbsp;is&nbsp;"email",&nbsp;the&nbsp;corresponding&nbsp;attribute&nbsp;name&nbsp;is&nbsp;"email_address"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'email'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'email_address'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;field&nbsp;name&nbsp;is&nbsp;"name",&nbsp;its&nbsp;value&nbsp;is&nbsp;defined&nbsp;by&nbsp;a&nbsp;PHP&nbsp;callback<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'name'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;function&nbsp;()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">first_name&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'&nbsp;'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">last_name</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br />&nbsp;&nbsp;&nbsp;&nbsp;];<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;filter&nbsp;out&nbsp;some&nbsp;fields,&nbsp;best&nbsp;used&nbsp;when&nbsp;you&nbsp;want&nbsp;to&nbsp;inherit&nbsp;the&nbsp;parent&nbsp;implementation<br />//&nbsp;and&nbsp;blacklist&nbsp;some&nbsp;sensitive&nbsp;fields.<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">fields</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$fields&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">fields</span><span style="color: #007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;remove&nbsp;fields&nbsp;that&nbsp;contain&nbsp;sensitive&nbsp;information<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">unset(</span><span style="color: #0000BB">$fields</span><span style="color: #007700">[</span><span style="color: #DD0000">'auth_key'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$fields</span><span style="color: #007700">[</span><span style="color: #DD0000">'password_hash'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$fields</span><span style="color: #007700">[</span><span style="color: #DD0000">'password_reset_token'</span><span style="color: #007700">]);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$fields</span><span style="color: #007700">;<br />}</span></code></pre>
<p>The return value of <code>fields()</code> should be an array. The array keys are the field names, and the array values
are the corresponding field definitions which can be either property/attribute names or anonymous functions
returning the corresponding field values.</p>
<blockquote><p>Warning: Because by default all attributes of a model will be included in the API result, you should
examine your data to make sure they do not contain sensitive information. If there is such information,
you should override <code>fields()</code> or <code>toArray()</code> to filter them out. In the above example, we choose
to filter out <code>auth_key</code>, <code>password_hash</code> and <code>password_reset_token</code>.</p>
</blockquote>
<p>You may use the <code>fields</code> query parameter to specify which fields in <code>fields()</code> should be included in the result.
If this parameter is not specified, all fields returned by <code>fields()</code> will be returned.</p>
<p>The method <span class="broken-link">yii\base\Model::extraFields()</span> is very similar to <span class="broken-link">yii\base\Model::fields()</span>.
The difference between these methods is that the latter declares the fields that should be returned by default,
while the former declares the fields that should only be returned when the user specifies them in the <code>expand</code> query parameter.</p>
<p>For example, <code>http://localhost/users?fields=id,email&amp;expand=profile</code> may return the following JSON data:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">[<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"id"</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"email"</span><span style="color: #007700">:&nbsp;</span><span style="color: #DD0000">"100@example.com"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"profile"</span><span style="color: #007700">:&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"id"</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">100</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"age"</span><span style="color: #007700">:&nbsp;</span><span style="color: #0000BB">30</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;},<br />&nbsp;&nbsp;&nbsp;&nbsp;...<br />]</span></code></pre>
<p>You may wonder who triggers the conversion from objects to arrays when an action returns an object or object collection.
The answer is that this is done by <span class="broken-link">yii\rest\Controller::serializer</span> in the <span class="broken-link">yii\base\Controller::afterAction()</span>
method. By default, <span class="broken-link">yii\rest\Serializer</span> is used as the serializer that can recognize resource objects extending from
<span class="broken-link">yii\base\Model</span> and collection objects implementing <span class="broken-link">yii\data\DataProviderInterface</span>. The serializer
will call the <code>toArray()</code> method of these objects and pass the <code>fields</code> and <code>expand</code> user parameters to the method.
If there are any embedded objects, they will also be converted into arrays recursively.</p>
<p>If all your resource objects are of <span class="broken-link">yii\base\Model</span> or its child classes, such as <span class="broken-link">yii\db\ActiveRecord</span>,
and you only use <span class="broken-link">yii\data\DataProviderInterface</span> as resource collections, the default data formatting
implementation should work very well. However, if you want to introduce some new resource classes that do not
extend from <span class="broken-link">yii\base\Model</span>, or if you want to use some new collection classes, you will need to
customize the serializer class and configure <span class="broken-link">yii\rest\Controller::serializer</span> to use it.
You new resource classes may use the trait <span class="broken-link">yii\base\ArrayableTrait</span> to support selective field output
as explained above.</p>
<h3>Pagination <a href="#pagination" name="pagination" class="hashlink">&para;</a></h3><p>For API endpoints about resource collections, pagination is supported out-of-box if you use 
<span class="broken-link">yii\data\DataProviderInterface</span> to serve the response data. In particular,
through query parameters <code>page</code> and <code>per-page</code>, an API consumer may specify which page of data
to return and how many data items should be included in each page. The corresponding response
will include the pagination information by the following HTTP headers (please also refer to the first example
in this chapter):</p>
<ul>
<li><code>X-Pagination-Total-Count</code>: The total number of data items;</li>
<li><code>X-Pagination-Page-Count</code>: The number of pages;</li>
<li><code>X-Pagination-Current-Page</code>: The current page (1-based);</li>
<li><code>X-Pagination-Per-Page</code>: The number of data items in each page;</li>
<li><code>Link</code>: A set of navigational links allowing client to traverse the data page by page.</li>
</ul>
<p>The response body will contain a list of data items in the requested page.</p>
<p>Sometimes, you may want to help simplify the client development work by including pagination information
directly in the response body. To do so, configure the <span class="broken-link">yii\rest\Serializer::collectionEnvelope</span> property
as follows:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">rest</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveController</span><span style="color: #007700">;<br /><br />class&nbsp;</span><span style="color: #0000BB">UserController&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveController<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$modelClass&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'app\models\User'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;</span><span style="color: #0000BB">$serializer&nbsp;</span><span style="color: #007700">=&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'yii\rest\Serializer'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'collectionEnvelope'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'items'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;];<br />}</span></code></pre>
<p>You may then get the following response for request <code>http://localhost/users</code>:</p>
<pre><code>HTTP/1.1 200 OK
Date: Sun, 02 Mar 2014 05:31:43 GMT
Server: Apache/2.2.26 (Unix) DAV/2 PHP/5.4.20 mod_ssl/2.2.26 OpenSSL/0.9.8y
X-Powered-By: PHP/5.4.20
X-Pagination-Total-Count: 1000
X-Pagination-Page-Count: 50
X-Pagination-Current-Page: 1
X-Pagination-Per-Page: 20
Link: &lt;http://localhost/users?page=1&gt;; rel=self, 
      &lt;http://localhost/users?page=2&gt;; rel=next, 
      &lt;http://localhost/users?page=50&gt;; rel=last
Transfer-Encoding: chunked
Content-Type: application/json; charset=UTF-8

{
    "items": [
        {
            "id": 1,
            ...
        },
        {
            "id": 2,
            ...
        },
        ...
    ],
    "_links": {
        "self": "http://localhost/users?page=1", 
        "next": "http://localhost/users?page=2", 
        "last": "http://localhost/users?page=50"
    },
    "_meta": {
        "totalCount": 1000,
        "pageCount": 50,
        "currentPage": 1,
        "perPage": 20
    }
}
</code></pre>
<h3>HATEOAS Support <a href="#hateoas-support" name="hateoas-support" class="hashlink">&para;</a></h3><p><a href="http://en.wikipedia.org/wiki/HATEOAS">HATEOAS</a>, an abbreviation for Hypermedia as the Engine of Application State,
promotes that RESTful APIs should return information that allow clients to discover actions supported for the returned
resources. The key of HATEOAS is to return a set of hyperlinks with relation information when resource data are served
by APIs.</p>
<p>You may let your model classes to implement the <span class="broken-link">yii\web\Linkable</span> interface to support HATEOAS. By implementing
this interface, a class is required to return a list of <span class="broken-link">yii\web\Link</span>. Typically, you should return at least
the <code>self</code> link, for example:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord</span><span style="color: #007700">;<br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">web</span><span style="color: #007700">\</span><span style="color: #0000BB">Link</span><span style="color: #007700">;<br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">web</span><span style="color: #007700">\</span><span style="color: #0000BB">Linkable</span><span style="color: #007700">;<br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">helpers</span><span style="color: #007700">\</span><span style="color: #0000BB">Url</span><span style="color: #007700">;<br /><br />class&nbsp;</span><span style="color: #0000BB">User&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord&nbsp;</span><span style="color: #007700">implements&nbsp;</span><span style="color: #0000BB">Linkable<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">getLinks</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">Link</span><span style="color: #007700">::</span><span style="color: #0000BB">REL_SELF&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">Url</span><span style="color: #007700">::</span><span style="color: #0000BB">to</span><span style="color: #007700">([</span><span style="color: #DD0000">'user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'id'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">id</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;];<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>When a <code>User</code> object is returned in a response, it will contain a <code>_links</code> element representing the links related
to the user, for example,</p>
<pre><code>{
    "id": 100,
    "email": "user@example.com",
    ...,
    "_links" =&gt; [
        "self": "https://example.com/users/100"
    ]
}
</code></pre>
<h2>Creating Controllers and Actions <a href="#creating-controllers-and-actions" name="creating-controllers-and-actions" class="hashlink">&para;</a></h2><p>So you have the resource data and you have specified how the resource data should be formatted, the next thing
to do is to create controller actions to expose the resource data to end users.</p>
<p>Yii provides two base controller classes to simplify your work of creating RESTful actions:
<span class="broken-link">yii\rest\Controller</span> and <span class="broken-link">yii\rest\ActiveController</span>. The difference between these two controllers
is that the latter provides a default set of actions that are specified designed to deal with
resources represented as ActiveRecord. So if you are using ActiveRecord and you are comfortable with
the provided built-in actions, you may consider creating your controller class by extending from
the latter. Otherwise, extending from <span class="broken-link">yii\rest\Controller</span> will allow you to develop actions
from scratch.</p>
<p>Both <span class="broken-link">yii\rest\Controller</span> and <span class="broken-link">yii\rest\ActiveController</span> provide the following features which will
be described in detail in the next few sections:</p>
<ul>
<li>Response format negotiation;</li>
<li>API version negotiation;</li>
<li>HTTP method validation;</li>
<li>User authentication;</li>
<li>Rate limiting.</li>
</ul>
<p><span class="broken-link">yii\rest\ActiveController</span> in addition provides the following features specifically for working
with ActiveRecord:</p>
<ul>
<li>A set of commonly used actions: <code>index</code>, <code>view</code>, <code>create</code>, <code>update</code>, <code>delete</code>, <code>options</code>;</li>
<li>User authorization in regard to the requested action and resource.</li>
</ul>
<p>When creating a new controller class, a convention in naming the controller class is to use
the type name of the resource and use singular form. For example, to serve user information,
the controller may be named as <code>UserController</code>.</p>
<p>Creating a new action is similar to creating an action for a Web application. The only difference
is that instead of rendering the result using a view by calling the <code>render()</code> method, for RESTful actions
you directly return the data. The <span class="broken-link">yii\rest\Controller::serializer</span> and the
<span class="broken-link">yii\web\Response</span> will handle the conversion from the original data to the requested
format. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">actionSearch</span><span style="color: #007700">(</span><span style="color: #0000BB">$keyword</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">SolrService</span><span style="color: #007700">::</span><span style="color: #0000BB">search</span><span style="color: #007700">(</span><span style="color: #0000BB">$keyword</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">;<br />}</span></code></pre>
<p>If your controller class extends from <span class="broken-link">yii\rest\ActiveController</span>, you should set
its <span class="broken-link">yii\rest\ActiveController::modelClass</span> property to be the name of the resource class
that you plan to serve through this controller. The class must implement <span class="broken-link">yii\db\ActiveRecordInterface</span>.</p>
<p>With <span class="broken-link">yii\rest\ActiveController</span>, you may want to disable some of the built-in actions or customize them.
To do so, override the <code>actions()</code> method like the following:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">actions</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$actions&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">actions</span><span style="color: #007700">();<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;disable&nbsp;the&nbsp;"delete"&nbsp;and&nbsp;"create"&nbsp;actions<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">unset(</span><span style="color: #0000BB">$actions</span><span style="color: #007700">[</span><span style="color: #DD0000">'delete'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$actions</span><span style="color: #007700">[</span><span style="color: #DD0000">'create'</span><span style="color: #007700">]);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;customize&nbsp;the&nbsp;data&nbsp;provider&nbsp;preparation&nbsp;with&nbsp;the&nbsp;"prepareDataProvider()"&nbsp;method<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$actions</span><span style="color: #007700">[</span><span style="color: #DD0000">'index'</span><span style="color: #007700">][</span><span style="color: #DD0000">'prepareDataProvider'</span><span style="color: #007700">]&nbsp;=&nbsp;[</span><span style="color: #0000BB">$this</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'prepareDataProvider'</span><span style="color: #007700">];<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$actions</span><span style="color: #007700">;<br />}<br /><br />public&nbsp;function&nbsp;</span><span style="color: #0000BB">prepareDataProvider</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;prepare&nbsp;and&nbsp;return&nbsp;a&nbsp;data&nbsp;provider&nbsp;for&nbsp;the&nbsp;"index"&nbsp;action<br /></span><span style="color: #007700">}</span></code></pre>
<p>The following list summarizes the built-in actions supported by <span class="broken-link">yii\rest\ActiveController</span>:</p>
<ul>
<li><span class="broken-link">yii\rest\IndexAction</span>: list resources page by page;</li>
<li><span class="broken-link">yii\rest\ViewAction</span>: return the details of a specified resource;</li>
<li><span class="broken-link">yii\rest\CreateAction</span>: create a new resource;</li>
<li><span class="broken-link">yii\rest\UpdateAction</span>: update an existing resource;</li>
<li><span class="broken-link">yii\rest\DeleteAction</span>: delete the specified resource;</li>
<li><span class="broken-link">yii\rest\OptionsAction</span>: return the supported HTTP methods.</li>
</ul>
<h2>Routing <a href="#routing" name="routing" class="hashlink">&para;</a></h2><p>With resource and controller classes ready, you can access the resources using the URL like
<code>http://localhost/index.php?r=user/create</code>. As you can see, the format of the URL is the same as that
for Web applications.</p>
<p>In practice, you usually want to enable pretty URLs and take advantage of HTTP verbs.
For example, a request <code>POST /users</code> would mean accessing the <code>user/create</code> action.
This can be done easily by configuring the <code>urlManager</code> application component in the application
configuration like the following:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #DD0000">'urlManager'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'enablePrettyUrl'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'enableStrictParsing'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'showScriptName'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'rules'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'yii\rest\UrlRule'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'controller'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'user'</span><span style="color: #007700">],<br />&nbsp;&nbsp;&nbsp;&nbsp;],<br />]</span></code></pre>
<p>Compared to the URL management for Web applications, the main new thing above is the use of
<span class="broken-link">yii\rest\UrlRule</span> for routing RESTful API requests. This special URL rule class will
create a whole set of child URL rules to support routing and URL creation for the specified controller(s).
For example, the above code is roughly equivalent to the following rules:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'PUT,PATCH&nbsp;users/&lt;id&gt;'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'user/update'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'DELETE&nbsp;users/&lt;id&gt;'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'user/delete'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'GET,HEAD&nbsp;users/&lt;id&gt;'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'user/view'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'POST&nbsp;users'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'user/create'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'GET,HEAD&nbsp;users'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'user/index'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'users/&lt;id&gt;'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'user/options'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'users'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'user/options'</span><span style="color: #007700">,<br />]</span></code></pre>
<p>And the following API endpoints are supported by this rule:</p>
<ul>
<li><code>GET /users</code>: list all users page by page;</li>
<li><code>HEAD /users</code>: show the overview information of user listing;</li>
<li><code>POST /users</code>: create a new user;</li>
<li><code>GET /users/123</code>: return the details of the user 123;</li>
<li><code>HEAD /users/123</code>: show the overview information of user 123;</li>
<li><code>PATCH /users/123</code> and <code>PUT /users/123</code>: update the user 123;</li>
<li><code>DELETE /users/123</code>: delete the user 123;</li>
<li><code>OPTIONS /users</code>: show the supported verbs regarding endpoint <code>/users</code>;</li>
<li><code>OPTIONS /users/123</code>: show the supported verbs regarding endpoint <code>/users/123</code>.</li>
</ul>
<p>You may configure the <code>only</code> and <code>except</code> options to explicitly list which actions to support or which
actions should be disabled, respectively. For example,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'yii\rest\UrlRule'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'controller'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'user'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'except'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[</span><span style="color: #DD0000">'delete'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'create'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'update'</span><span style="color: #007700">],<br />],</span></code></pre>
<p>You may also configure <code>patterns</code> or <code>extraPatterns</code> to redefine existing patterns or add new patterns supported by this rule.
For example, to support a new action <code>search</code> by the endpoint <code>GET /users/search</code>, configure the <code>extraPatterns</code> option as follows,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'yii\rest\UrlRule'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'controller'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'user'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'extraPatterns'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'GET&nbsp;search'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'search'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;],</span></code></pre>
<p>You may have noticed that the controller ID <code>user</code> appears in plural form as <code>users</code> in the endpoints.
This is because <span class="broken-link">yii\rest\UrlRule</span> automatically pluralizes controller IDs for them to use in endpoints.
You may disable this behavior by setting <span class="broken-link">yii\rest\UrlRule::pluralize</span> to be false, or if you want
to use some special names you may configure the <span class="broken-link">yii\rest\UrlRule::controller</span> property.</p>
<h2>Authentication <a href="#authentication" name="authentication" class="hashlink">&para;</a></h2><p>Unlike Web applications, RESTful APIs should be stateless, which means sessions or cookies should not
be used. Therefore, each request should come with some sort of authentication credentials because
the user authentication status may not be maintained by sessions or cookies. A common practice is
to send a secret access token with each request to authenticate the user. Since an access token
can be used to uniquely identify and authenticate a user, <strong>the API requests should always be sent
via HTTPS to prevent from man-in-the-middle (MitM) attacks</strong>.</p>
<p>There are different ways to send an access token:</p>
<ul>
<li><a href="http://en.wikipedia.org/wiki/Basic_access_authentication">HTTP Basic Auth</a>: the access token
is sent as the username. This is should only be used when an access token can be safely stored
on the API consumer side. For example, the API consumer is a program running on a server.</li>
<li>Query parameter: the access token is sent as a query parameter in the API URL, e.g.,
<code>https://example.com/users?access-token=xxxxxxxx</code>. Because most Web servers will keep query
parameters in server logs, this approach should be mainly used to serve <code>JSONP</code> requests which
cannot use HTTP headers to send access tokens.</li>
<li><a href="http://oauth.net/2/">OAuth 2</a>: the access token is obtained by the consumer from an authorization
server and sent to the API server via <a href="http://tools.ietf.org/html/rfc6750">HTTP Bearer Tokens</a>,
according to the OAuth2 protocol.</li>
</ul>
<p>Yii supports all of the above authentication methods. You can also easily create new authentication methods.</p>
<p>To enable authentication for your APIs, do the following two steps:</p>
<ol>
<li>Specify which authentication methods you plan to use by configuring the <code>authenticator</code> behavior
in your REST controller classes.</li>
<li>Implement <span class="broken-link">yii\web\IdentityInterface::findIdentityByAccessToken()</span> in your <span class="broken-link">yii\web\User::identityClass</span>.</li>
</ol>
<p>For example, to use HTTP Basic Auth, you may configure <code>authenticator</code> as follows,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">helpers</span><span style="color: #007700">\</span><span style="color: #0000BB">ArrayHelper</span><span style="color: #007700">;<br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">filters</span><span style="color: #007700">\</span><span style="color: #0000BB">auth</span><span style="color: #007700">\</span><span style="color: #0000BB">HttpBasicAuth</span><span style="color: #007700">;<br /><br />public&nbsp;function&nbsp;</span><span style="color: #0000BB">behaviors</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">ArrayHelper</span><span style="color: #007700">::</span><span style="color: #0000BB">merge</span><span style="color: #007700">(</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">behaviors</span><span style="color: #007700">(),&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'authenticator'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">HttpBasicAuth</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br />&nbsp;&nbsp;&nbsp;&nbsp;]);<br />}</span></code></pre>
<p>If you want to support all three authentication methods explained above, you can use <code>CompositeAuth</code> like the following,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">helpers</span><span style="color: #007700">\</span><span style="color: #0000BB">ArrayHelper</span><span style="color: #007700">;<br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">filters</span><span style="color: #007700">\</span><span style="color: #0000BB">auth</span><span style="color: #007700">\</span><span style="color: #0000BB">CompositeAuth</span><span style="color: #007700">;<br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">filters</span><span style="color: #007700">\</span><span style="color: #0000BB">auth</span><span style="color: #007700">\</span><span style="color: #0000BB">HttpBasicAuth</span><span style="color: #007700">;<br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">filters</span><span style="color: #007700">\</span><span style="color: #0000BB">auth</span><span style="color: #007700">\</span><span style="color: #0000BB">HttpBearerAuth</span><span style="color: #007700">;<br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">filters</span><span style="color: #007700">\</span><span style="color: #0000BB">auth</span><span style="color: #007700">\</span><span style="color: #0000BB">QueryParamAuth</span><span style="color: #007700">;<br /><br />public&nbsp;function&nbsp;</span><span style="color: #0000BB">behaviors</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">ArrayHelper</span><span style="color: #007700">::</span><span style="color: #0000BB">merge</span><span style="color: #007700">(</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">behaviors</span><span style="color: #007700">(),&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'authenticator'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">CompositeAuth</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'authMethods'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">HttpBasicAuth</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">HttpBearerAuth</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">QueryParamAuth</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br />&nbsp;&nbsp;&nbsp;&nbsp;]);<br />}</span></code></pre>
<p>Each element in <code>authMethods</code> should be an auth method class name or a configuration array.</p>
<p>Implementation of <code>findIdentityByAccessToken()</code> is application specific. For example, in simple scenarios
when each user can only have one access token, you may store the access token in an <code>access_token</code> column
in the user table. The method can then be readily implemented in the <code>User</code> class as follows,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">db</span><span style="color: #007700">\</span><span style="color: #0000BB">ActiveRecord</span><span style="color: #007700">;<br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">web</span><span style="color: #007700">\</span><span style="color: #0000BB">IdentityInterface</span><span style="color: #007700">;<br /><br />class&nbsp;</span><span style="color: #0000BB">User&nbsp;</span><span style="color: #007700">extends&nbsp;</span><span style="color: #0000BB">ActiveRecord&nbsp;</span><span style="color: #007700">implements&nbsp;</span><span style="color: #0000BB">IdentityInterface<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">findIdentityByAccessToken</span><span style="color: #007700">(</span><span style="color: #0000BB">$token</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;static::</span><span style="color: #0000BB">findOne</span><span style="color: #007700">([</span><span style="color: #DD0000">'access_token'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$token</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</span></code></pre>
<p>After authentication is enabled as described above, for every API request, the requested controller
will try to authenticate the user in its <code>beforeAction()</code> step.</p>
<p>If authentication succeeds, the controller will perform other checks (such as rate limiting, authorization)
and then run the action. The authenticated user identity information can be retrieved via <code>Yii::$app-&gt;user-&gt;identity</code>.</p>
<p>If authentication fails, a response with HTTP status 401 will be sent back together with other appropriate headers
(such as a <code>WWW-Authenticate</code> header for HTTP Basic Auth).</p>
<h2>Authorization <a href="#authorization" name="authorization" class="hashlink">&para;</a></h2><p>After a user is authenticated, you probably want to check if he has the permission to perform the requested
action for the requested resource. This process is called <em>authorization</em> which is covered in detail in
the <a href="guide-en-authorization.html">Authorization chapter</a>.</p>
<p>You may use the Role-Based Access Control (RBAC) component to implementation authorization.</p>
<p>To simplify the authorization check, you may also override the <span class="broken-link">yii\rest\Controller::checkAccess()</span> method
and then call this method in places where authorization is needed. By default, the built-in actions provided
by <span class="broken-link">yii\rest\ActiveController</span> will call this method when they are about to run.</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">/**<br />&nbsp;*&nbsp;Checks&nbsp;the&nbsp;privilege&nbsp;of&nbsp;the&nbsp;current&nbsp;user.<br />&nbsp;*<br />&nbsp;*&nbsp;This&nbsp;method&nbsp;should&nbsp;be&nbsp;overridden&nbsp;to&nbsp;check&nbsp;whether&nbsp;the&nbsp;current&nbsp;user&nbsp;has&nbsp;the&nbsp;privilege<br />&nbsp;*&nbsp;to&nbsp;run&nbsp;the&nbsp;specified&nbsp;action&nbsp;against&nbsp;the&nbsp;specified&nbsp;data&nbsp;model.<br />&nbsp;*&nbsp;If&nbsp;the&nbsp;user&nbsp;does&nbsp;not&nbsp;have&nbsp;access,&nbsp;a&nbsp;[[ForbiddenHttpException]]&nbsp;should&nbsp;be&nbsp;thrown.<br />&nbsp;*<br />&nbsp;*&nbsp;@param&nbsp;string&nbsp;$action&nbsp;the&nbsp;ID&nbsp;of&nbsp;the&nbsp;action&nbsp;to&nbsp;be&nbsp;executed<br />&nbsp;*&nbsp;@param&nbsp;\yii\base\Model&nbsp;$model&nbsp;the&nbsp;model&nbsp;to&nbsp;be&nbsp;accessed.&nbsp;If&nbsp;null,&nbsp;it&nbsp;means&nbsp;no&nbsp;specific&nbsp;model&nbsp;is&nbsp;being&nbsp;accessed.<br />&nbsp;*&nbsp;@param&nbsp;array&nbsp;$params&nbsp;additional&nbsp;parameters<br />&nbsp;*&nbsp;@throws&nbsp;ForbiddenHttpException&nbsp;if&nbsp;the&nbsp;user&nbsp;does&nbsp;not&nbsp;have&nbsp;access<br />&nbsp;*/<br /></span><span style="color: #007700">public&nbsp;function&nbsp;</span><span style="color: #0000BB">checkAccess</span><span style="color: #007700">(</span><span style="color: #0000BB">$action</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$model&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$params&nbsp;</span><span style="color: #007700">=&nbsp;[])<br />{<br />}</span></code></pre>
<h2>Rate Limiting <a href="#rate-limiting" name="rate-limiting" class="hashlink">&para;</a></h2><p>To prevent abuse, you should consider adding rate limiting to your APIs. For example, you may limit the API usage
of each user to be at most 100 API calls within a period of 10 minutes. If too many requests are received from a user
within the period of the time, a response with status code 429 (meaning Too Many Requests) should be returned.</p>
<p>To enable rate limiting, the <span class="broken-link">yii\web\User::identityClass</span> should implement <span class="broken-link">yii\filters\RateLimitInterface</span>.
This interface requires implementation of the following three methods:</p>
<ul>
<li><code>getRateLimit()</code>: returns the maximum number of allowed requests and the time period, e.g., <code>[100, 600]</code> means
at most 100 API calls within 600 seconds.</li>
<li><code>loadAllowance()</code>: returns the number of remaining requests allowed and the corresponding UNIX timestamp
when the rate limit is checked last time.</li>
<li><code>saveAllowance()</code>: saves the number of remaining requests allowed and the current UNIX timestamp.</li>
</ul>
<p>You may use two columns in the user table to record the allowance and timestamp information.
And <code>loadAllowance()</code> and <code>saveAllowance()</code> can then be implementation by reading and saving the values
of the two columns corresponding to the current authenticated user. To improve performance, you may also
consider storing these information in cache or some NoSQL storage.</p>
<p>Once the identity class implements the required interface, Yii will automatically use <span class="broken-link">yii\filters\RateLimiter</span>
configured as an action filter for <span class="broken-link">yii\rest\Controller</span> to perform rate limiting check. The rate limiter
will thrown a <span class="broken-link">yii\web\TooManyRequestsHttpException</span> if rate limit is exceeded. You may configure the rate limiter
as follows in your REST controller classes,</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">helpers</span><span style="color: #007700">\</span><span style="color: #0000BB">ArrayHelper</span><span style="color: #007700">;<br />use&nbsp;</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">filters</span><span style="color: #007700">\</span><span style="color: #0000BB">RateLimiter</span><span style="color: #007700">;<br /><br />public&nbsp;function&nbsp;</span><span style="color: #0000BB">behaviors</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">ArrayHelper</span><span style="color: #007700">::</span><span style="color: #0000BB">merge</span><span style="color: #007700">(</span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">behaviors</span><span style="color: #007700">(),&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'rateLimiter'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">RateLimiter</span><span style="color: #007700">::</span><span style="color: #0000BB">className</span><span style="color: #007700">(),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'enableRateLimitHeaders'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br />&nbsp;&nbsp;&nbsp;&nbsp;]);<br />}</span></code></pre>
<p>When rate limiting is enabled, by default every response will be sent with the following HTTP headers containing
the current rate limiting information:</p>
<ul>
<li><code>X-Rate-Limit-Limit</code>: The maximum number of requests allowed with a time period;</li>
<li><code>X-Rate-Limit-Remaining</code>: The number of remaining requests in the current time period;</li>
<li><code>X-Rate-Limit-Reset</code>: The number of seconds to wait in order to get the maximum number of allowed requests.</li>
</ul>
<p>You may disable these headers by configuring <span class="broken-link">yii\filters\RateLimiter::enableRateLimitHeaders</span> to be false,
like shown in the above code example.</p>
<h2>Error Handling <a href="#error-handling" name="error-handling" class="hashlink">&para;</a></h2><p>When handling a RESTful API request, if there is an error in the user request or if something unexpected
happens on the server, you may simply throw an exception to notify the user something wrong happened. 
If you can identify the cause of the error (e.g. the requested resource does not exist), you should 
consider throwing an exception with a proper HTTP status code (e.g. <span class="broken-link">yii\web\NotFoundHttpException</span> 
representing a 404 HTTP status code). Yii will send the response with the corresponding HTTP status
code and text. It will also include in the response body the serialized representation of the 
exception. For example,</p>
<pre><code>HTTP/1.1 404 Not Found
Date: Sun, 02 Mar 2014 05:31:43 GMT
Server: Apache/2.2.26 (Unix) DAV/2 PHP/5.4.20 mod_ssl/2.2.26 OpenSSL/0.9.8y
Transfer-Encoding: chunked
Content-Type: application/json; charset=UTF-8

{
    "type": "yii\\web\\NotFoundHttpException",
    "name": "Not Found Exception",
    "message": "The requested resource was not found.",
    "code": 0,
    "status": 404
}
</code></pre>
<p>The following list summarizes the HTTP status code that are used by the Yii REST framework:</p>
<ul>
<li><code>200</code>: OK. Everything worked as expected.</li>
<li><code>201</code>: A resource was successfully created in response to a <code>POST</code> request. The <code>Location</code> header
 contains the URL pointing to the newly created resource.</li>
<li><code>204</code>: The request is handled successfully and the response contains no body content (like a <code>DELETE</code> request).</li>
<li><code>304</code>: Resource was not modified. You can use the cached version.</li>
<li><code>400</code>: Bad request. This could be caused by various reasons from the user side, such as invalid JSON
 data in the request body, invalid action parameters, etc.</li>
<li><code>401</code>: Authentication failed.</li>
<li><code>403</code>: The authenticated user is not allowed to access the specified API endpoint.</li>
<li><code>404</code>: The requested resource does not exist.</li>
<li><code>405</code>: Method not allowed. Please check the <code>Allow</code> header for allowed HTTP methods.</li>
<li><code>415</code>: Unsupported media type. The requested content type or version number is invalid.</li>
<li><code>422</code>: Data validation failed (in response to a <code>POST</code> request, for example). Please check the response body for detailed error messages.</li>
<li><code>429</code>: Too many requests. The request is rejected due to rate limiting.</li>
<li><code>500</code>: Internal server error. This could be caused by internal program errors.</li>
</ul>
<h2>API Versioning <a href="#api-versioning" name="api-versioning" class="hashlink">&para;</a></h2><p>Your APIs should be versioned. Unlike Web applications which you have full control on both client side and server side
code, for APIs you usually do not have control of the client code that consumes the APIs. Therefore, backward
compatibility (BC) of the APIs should be maintained whenever possible, and if some BC-breaking changes must be
introduced to the APIs, you should bump up the version number. You may refer to <a href="http://semver.org/">Symantic Versioning</a>
for more information about designing the version numbers of your APIs.</p>
<p>Regarding how to implement API versioning, a common practice is to embed the version number in the API URLs.
For example, <code>http://example.com/v1/users</code> stands for <code>/users</code> API of version 1. Another method of API versioning
which gains momentum recently is to put version numbers in the HTTP request headers, typically through the <code>Accept</code> header,
like the following:</p>
<pre><code>// via a parameter
Accept: application/json; version=v1
// via a vendor content type
Accept: application/vnd.company.myapp-v1+json
</code></pre>
<p>Both methods have pros and cons, and there are a lot of debates about them. Below we describe a practical strategy
of API versioning that is kind of a mix of these two methods:</p>
<ul>
<li>Put each major version of API implementation in a separate module whose ID is the major version number (e.g. <code>v1</code>, <code>v2</code>).
Naturally, the API URLs will contain major version numbers.</li>
<li>Within each major version (and thus within the corresponding module), use the <code>Accept</code> HTTP request header
to determine the minor version number and write conditional code to respond to the minor versions accordingly.</li>
</ul>
<p>For each module serving a major version, it should include the resource classes and the controller classes
serving for that specific version. To better separate code responsibility, you may keep a common set of
base resource and controller classes, and subclass them in each individual version module. Within the subclasses,
implement the concrete code such as <code>Model::fields()</code>.</p>
<p>Your code may be organized like the following:</p>
<pre><code>api/
    common/
        controllers/
            UserController.php
            PostController.php
        models/
            User.php
            Post.php
    modules/
        v1/
            controllers/
                UserController.php
                PostController.php
            models/
                User.php
                Post.php
        v2/
            controllers/
                UserController.php
                PostController.php
            models/
                User.php
                Post.php
</code></pre>
<p>Your application configuration would look like:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">return&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'modules'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'v1'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'basePath'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'@app/modules/v1'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'v2'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'basePath'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'@app/modules/v2'</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br />&nbsp;&nbsp;&nbsp;&nbsp;],<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'components'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'urlManager'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'enablePrettyUrl'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'enableStrictParsing'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'showScriptName'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'rules'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'yii\rest\UrlRule'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'controller'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[</span><span style="color: #DD0000">'v1/user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'v1/post'</span><span style="color: #007700">]],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[</span><span style="color: #DD0000">'class'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'yii\rest\UrlRule'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'controller'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;[</span><span style="color: #DD0000">'v2/user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'v2/post'</span><span style="color: #007700">]],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],<br />&nbsp;&nbsp;&nbsp;&nbsp;],<br />];</span></code></pre>
<p>As a result, <code>http://example.com/v1/users</code> will return the list of users in version 1, while
<code>http://example.com/v2/users</code> will return version 2 users.</p>
<p>Using modules, code for different major versions can be well isolated. And it is still possible
to reuse code across modules via common base classes and other shared classes.</p>
<p>To deal with minor version numbers, you may take advantage of the content negotiation
feature provided by the <span class="broken-link">yii\filters\ContentNegotiator</span> behavior. The <code>contentNegotiator</code>
behavior will set the <span class="broken-link">yii\web\Response::acceptParams</span> property when it determines which
content type to support.</p>
<p>For example, if a request is sent with the HTTP header <code>Accept: application/json; version=v1</code>,
after content negotiation, <span class="broken-link">yii\web\Response::acceptParams</span> will contain the value <code>['version' =&gt; 'v1']</code>.</p>
<p>Based on the version information in <code>acceptParams</code>, you may write conditional code in places
such as actions, resource classes, serializers, etc.</p>
<p>Since minor versions require maintaining backward compatibility, hopefully there are not much
version checks in your code. Otherwise, chances are that you may need to create a new major version.</p>
<h2>Caching <a href="#caching" name="caching" class="hashlink">&para;</a></h2><h2>Documentation <a href="#documentation" name="documentation" class="hashlink">&para;</a></h2><h2>Testing <a href="#testing" name="testing" class="hashlink">&para;</a></h2>        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Mon, 19 Jan 2015 03:03:05 +0700</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script type="text/javascript">jQuery(document).ready(function () {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>

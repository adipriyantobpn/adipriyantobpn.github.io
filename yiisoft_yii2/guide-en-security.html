<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="language" content="en" />
        <link href="./assets/4b76110e/css/bootstrap.css" rel="stylesheet">
<link href="./assets/710de68d/style.css" rel="stylesheet">
<script src="./assets/75e46bf0/jquery.js"></script>
<script src="./assets/4b76110e/js/bootstrap.js"></script>
<script src="./assets/a44c75fa/jssearch.js"></script>    <title>Yii Framework 2.0 API Documentation</title>
</head>
<body>

<div class="wrap">
    <nav id="w64" class="navbar-inverse navbar-fixed-top navbar" role="navigation"><div class="navbar-header"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#w64-collapse"><span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span></button><a class="navbar-brand" href="./index.html">Yii Framework 2.0 API Documentation</a></div><div id="w64-collapse" class="collapse navbar-collapse"><ul id="w65" class="navbar-nav nav"><li><a href="./index.html">Class reference</a></li>
<li><a href="./guide-en-README.html">Guide</a></li></ul><div class="navbar-form navbar-left" role="search">
  <div class="form-group">
    <input id="searchbox" type="text" class="form-control" placeholder="Search">
  </div>
</div>
</div></nav>
    <div id="search-resultbox" style="display: none;" class="modal-content">
        <ul id="search-results">
        </ul>
    </div>

    
<div class="row">
    <div class="col-md-2">
                <div id="navigation" class="list-group"></div>    </div>
    <div class="col-md-9 guide-content" role="main">
        <h1>Security <a href="#security" name="security" class="hashlink">&para;</a></h1><p>Good security is vital to the health and success of many websites. Unfortunately, many developers may cut corners when it comes to security due to a lack of understanding or too large of an implementation hurdle. To make your Yii-based site as secure as possible, the Yii framework has baked in several excellent, and easy to use, security features.</p>
<h2>Hashing and verifying passwords <a href="#hashing-and-verifying-passwords" name="hashing-and-verifying-passwords" class="hashlink">&para;</a></h2><p>Most developers know that you cannot store passwords in plain text, but many believe it's safe to hash passwords using <code>md5</code> or <code>sha1</code>. There was a time when those hashing algorithms were sufficient, but modern hardware makes it possible to break those hashes very quickly using a brute force attack.</p>
<p>In order to truly secure user passwords, even in the worst case scenario (your database is broken into), you need to use a hashing algorithm that is resistant to brute force attacks. The best current choice is <code>bcrypt</code>. In PHP, you can create a <code>bcrypt</code> hash by using the <a href="http://php.net/manual/en/function.crypt.php">crypt function</a>. However, this function is not easy to use properly, so Yii provides two helper functions to make securely generating and verifying hashes easier.</p>
<p>When a user provides a password for the first time (e.g., upon registration), the password needs to be hashed:</p>
<pre><code class="language-php"><span style="color: #0000BB">$hash&nbsp;</span><span style="color: #007700">=&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">helpers</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">::</span><span style="color: #0000BB">generatePasswordHash</span><span style="color: #007700">(</span><span style="color: #0000BB">$password</span><span style="color: #007700">);</span></code></pre>
<p>The hash would then be associated with the model, so that it will be stored in the database for later use.</p>
<p>When user attempts to log in, the submitted log in password must be verified against the previously hashed and stored password:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #007700">use&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">helpers</span><span style="color: #007700">;<br />if&nbsp;(</span><span style="color: #0000BB">Security</span><span style="color: #007700">::</span><span style="color: #0000BB">validatePassword</span><span style="color: #007700">(</span><span style="color: #0000BB">$password</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$hash</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;all&nbsp;good,&nbsp;logging&nbsp;user&nbsp;in<br /></span><span style="color: #007700">}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;wrong&nbsp;password<br /></span><span style="color: #007700">}</span></code></pre>
<h2>Creating random data <a href="#creating-random-data" name="creating-random-data" class="hashlink">&para;</a></h2><p>Random data is useful in many cases. For example, when resetting a password via email you need to generate a token,
save it to database and send it via email to end user so he's able to prove that email belongs to him. It is very
important for this token to be truly unique else there will be a possibility to predict a value and reset another user's
password.</p>
<p>Yii security helper makes it as simple as:</p>
<pre><code class="language-php"><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">helpers</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">::</span><span style="color: #0000BB">generateRandomKey</span><span style="color: #007700">();</span></code></pre>
<h2>Encryption and decryption <a href="#encryption-and-decryption" name="encryption-and-decryption" class="hashlink">&para;</a></h2><p>In order to encrypt data so only person knowing a secret passphrase or having a secret key will be able to decrypt it.
For example, we need to store some information in our database but we need to make sure only user knowing a secret code
can view it (even if database is leaked):</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;$data&nbsp;and&nbsp;$secretWord&nbsp;are&nbsp;from&nbsp;the&nbsp;form<br /></span><span style="color: #0000BB">$encryptedData&nbsp;</span><span style="color: #007700">=&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">helpers</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">::</span><span style="color: #0000BB">encrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$secretWord</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;store&nbsp;$encryptedData&nbsp;to&nbsp;database</span></code></pre>
<p>Then when user want to read it:</p>
<pre><code class="language-php"><span style="color: #0000BB"></span><span style="color: #FF8000">//&nbsp;$secretWord&nbsp;is&nbsp;from&nbsp;the&nbsp;form,&nbsp;$encryptedData&nbsp;is&nbsp;from&nbsp;database<br /></span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;\</span><span style="color: #0000BB">yii</span><span style="color: #007700">\</span><span style="color: #0000BB">helpers</span><span style="color: #007700">\</span><span style="color: #0000BB">Security</span><span style="color: #007700">::</span><span style="color: #0000BB">decrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$encryptedData</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$secretWord</span><span style="color: #007700">);</span></code></pre>
<h2>Confirming data integrity <a href="#confirming-data-integrity" name="confirming-data-integrity" class="hashlink">&para;</a></h2><p>Making sure data wasn't modified</p>
<p>hashData()
validateData()</p>
<h2>Securing Cookies <a href="#securing-cookies" name="securing-cookies" class="hashlink">&para;</a></h2><ul>
<li>validation</li>
<li>httpOnly</li>
</ul>
<h2>See also <a href="#see-also" name="see-also" class="hashlink">&para;</a></h2><ul>
<li><a href="guide-en-view.html#security">Views security</a></li>
</ul>
        <div class="toplink"><a href="#" class="h1" title="go to top"><span class="glyphicon glyphicon-arrow-up"></a></div>
    </div>
</div>


</div>

<footer class="footer">
        <p class="pull-right"><small>Page generated on Mon, 19 Jan 2015 02:32:13 +0700</small></p>
    Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></footer>

<script type="text/javascript">jQuery(document).ready(function () {
    var shiftWindow = function () { scrollBy(0, -50) };
    if (location.hash) shiftWindow();
    window.addEventListener("hashchange", shiftWindow);
var element = document.createElement("script");
element.src = "./jssearch.index.js";
document.body.appendChild(element);

var searchBox = $('#searchbox');

// search when typing in search field
searchBox.on("keyup", function(event) {
    var query = $(this).val();

    if (query == '' || event.which == 27) {
        $('#search-resultbox').hide();
        return;
    } else if (event.which == 13) {
        var selectedLink = $('#search-resultbox a.selected');
        if (selectedLink.length != 0) {
            document.location = selectedLink.attr('href');
            return;
        }
    } else if (event.which == 38 || event.which == 40) {
        $('#search-resultbox').show();

        var selected = $('#search-resultbox a.selected');
        if (selected.length == 0) {
            $('#search-results').find('a').first().addClass('selected');
        } else {
            var next;
            if (event.which == 40) {
                next = selected.parent().next().find('a').first();
            } else {
                next = selected.parent().prev().find('a').first();
            }
            if (next.length != 0) {
                var resultbox = $('#search-results');
                var position = next.position();

//              TODO scrolling is buggy and jumps around
//                resultbox.scrollTop(Math.floor(position.top));
//                console.log(position.top);

                selected.removeClass('selected');
                next.addClass('selected');
            }
        }

        return;
    }
    $('#search-resultbox').show();
    $('#search-results').html('<li><span class="no-results">No results</span></li>');

    var result = jssearch.search(query);

    if (result.length > 0) {
        var i = 0;
        var resHtml = '';

        for (var key in result) {
            if (i++ > 20) {
                break;
            }
            resHtml = resHtml +
            '<li><a href="' + result[key].file.u.substr(3) +'"><span class="title">' + result[key].file.t + '</span>' +
            '<span class="description">' + result[key].file.d + '</span></a></li>';
        }
        $('#search-results').html(resHtml);
    }
});

// hide the search results on ESC
$(document).on("keyup", function(event) { if (event.which == 27) { $('#search-resultbox').hide(); } });
// hide search results on click to document
$(document).bind('click', function (e) { $('#search-resultbox').hide(); });
// except the following:
searchBox.bind('click', function(e) { e.stopPropagation(); });
$('#search-resultbox').bind('click', function(e) { e.stopPropagation(); });

});</script></body>
</html>
